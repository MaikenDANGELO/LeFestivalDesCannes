{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { prestataires, billetterie, utilisateurs, avis } from \"./data\";\nimport bcrypt from 'bcryptjs';\nfunction getAllPrestataires() {\n  return {\n    error: 0,\n    data: prestataires\n  };\n}\nfunction insertCommandeBillet(vue, total) {\n  try {\n    const lastBilletterie = billetterie.length > 0 ? billetterie[billetterie.length - 1] : null;\n    let newId = lastBilletterie ? lastBilletterie.id_billetterie + 1 : 1;\n    let ticketQuantity = 0;\n    for (let i = 0; i < vue.form.tickets.length; i++) {\n      ticketQuantity += vue.form.tickets[i].quantity;\n    }\n    let insert = {\n      \"id_billetterie\": newId,\n      \"nombre_billets\": ticketQuantity,\n      \"prix_total\": total,\n      \"date_achat\": new Date().toISOString().split('T')[0],\n      \"email\": vue.form.email\n    };\n\n    // Ajouter l'objet à billetterie\n    billetterie.push(insert);\n    return {\n      error: 0,\n      status: 200\n    };\n  } catch (error) {\n    console.error(\"Erreur lors de l'ajout de la billetterie :\", error.message);\n    return {\n      error: 1,\n      status: 404,\n      data: \"Erreur lors de l'ajout de la billetterie :\" + error.message\n    };\n  }\n}\nasync function connexion(login, mdp) {\n  if (!login) return {\n    error: 1,\n    status: 404,\n    data: \"Le login donné n'est pas valide\"\n  };\n  if (!mdp) return {\n    error: 1,\n    status: 404,\n    data: \"Le mot de passe donné n'est pas valide\"\n  };\n  let Account = utilisateurs.find(u => u.email_utilisateur === login);\n  if (!Account) return {\n    error: 1,\n    status: 404,\n    data: \"Aucun utilisateur n'est lié à ce login\"\n  };\n  try {\n    const correspond = await bcrypt.compare(mdp, Account.mot_de_passe);\n    if (correspond) {\n      return {\n        error: 0,\n        status: 200,\n        data: Account\n      };\n    } else {\n      return {\n        error: 1,\n        status: 404,\n        data: \"Le mot de passe ne correspond pas\"\n      };\n    }\n  } catch (error) {\n    console.error('Erreur lors de la vérification du mot de passe :', error);\n  }\n}\nasync function getAvisOfPrestataire(prestataire_id) {\n  if (!prestataire_id) return {\n    error: 1,\n    status: 404,\n    data: \"L'identifiant donné n'est pas valide\"\n  };\n  let prest_commentaires = [];\n  avis.forEach(a => {\n    if (parseInt(a['id_prestataire']) === parseInt(prestataire_id)) {\n      prest_commentaires.push(a);\n    }\n  });\n  return {\n    error: 0,\n    status: 200,\n    data: prest_commentaires\n  };\n}\nasync function sendAvisOfUser(data) {\n  try {\n    let newId = avis.length + 1;\n    let insert = {\n      id_commentaire: newId,\n      id_prestataire: parseInt(data[0]),\n      id_utilisateur: data[3],\n      texte: data[2],\n      note: data[1]\n    };\n    avis.push(insert);\n    return {\n      error: 0,\n      status: 200\n    };\n  } catch (error) {\n    console.error(\"Erreur lors de l'ajout de la billetterie :\", error.message);\n    return {\n      error: 1,\n      status: 404,\n      data: \"Erreur lors de l'ajout de l'avis :\" + error.message\n    };\n  }\n}\nexport default {\n  getAllPrestataires,\n  insertCommandeBillet,\n  connexion,\n  getAvisOfPrestataire,\n  sendAvisOfUser\n};","map":{"version":3,"names":["prestataires","billetterie","utilisateurs","avis","bcrypt","getAllPrestataires","error","data","insertCommandeBillet","vue","total","lastBilletterie","length","newId","id_billetterie","ticketQuantity","i","form","tickets","quantity","insert","Date","toISOString","split","email","push","status","console","message","connexion","login","mdp","Account","find","u","email_utilisateur","correspond","compare","mot_de_passe","getAvisOfPrestataire","prestataire_id","prest_commentaires","forEach","a","parseInt","sendAvisOfUser","id_commentaire","id_prestataire","id_utilisateur","texte","note"],"sources":["/home/raskiel/Code/Code BUT/Annee2/SAE_S3-S4/frontend/src/datasource/controller.js"],"sourcesContent":["import { prestataires, billetterie, utilisateurs, avis } from \"./data\";\nimport bcrypt from 'bcryptjs';\n\nfunction getAllPrestataires() {\n    return { error: 0, data: prestataires };\n}\n\nfunction insertCommandeBillet(vue, total){\n    try{\n    const lastBilletterie = billetterie.length > 0 ? billetterie[billetterie.length - 1] : null;\n\n    let newId = lastBilletterie ? lastBilletterie.id_billetterie + 1 : 1;\n    let ticketQuantity = 0;\n        for (let i = 0; i < vue.form.tickets.length; i++) {\n            ticketQuantity += vue.form.tickets[i].quantity;\n        }\n\n    let insert = {\n        \"id_billetterie\": newId,\n        \"nombre_billets\": ticketQuantity,\n        \"prix_total\": total,\n        \"date_achat\": new Date().toISOString().split('T')[0],\n        \"email\": vue.form.email,\n    };\n\n    // Ajouter l'objet à billetterie\n    billetterie.push(insert);\n    return {error: 0, status: 200}\n\n    } catch (error) {\n        console.error(\"Erreur lors de l'ajout de la billetterie :\", error.message);\n        return {error: 1, status: 404, data:\"Erreur lors de l'ajout de la billetterie :\" + error.message}\n    }\n}\n\nasync function connexion(login, mdp){\n    if(!login) return {error: 1, status: 404, data: \"Le login donné n'est pas valide\"};\n    if(!mdp) return {error: 1, status: 404, data: \"Le mot de passe donné n'est pas valide\"};\n\n    let Account = utilisateurs.find(u => u.email_utilisateur === login);\n    if (!Account) return {error: 1, status: 404, data: \"Aucun utilisateur n'est lié à ce login\"};\n\n\n    try {\n        const correspond = await bcrypt.compare(mdp, Account.mot_de_passe);\n        if (correspond) {\n            return {error: 0, status: 200, data: Account};\n        } else {\n            return {error: 1, status: 404, data: \"Le mot de passe ne correspond pas\"};\n        }\n    } catch (error) {\n        console.error('Erreur lors de la vérification du mot de passe :', error);\n    }\n}\n\nasync function getAvisOfPrestataire(prestataire_id) {\n    if(!prestataire_id) return {error: 1, status: 404, data: \"L'identifiant donné n'est pas valide\"};\n    let prest_commentaires = [];\n    avis.forEach( (a) => {\n        if(parseInt(a['id_prestataire']) === parseInt(prestataire_id)){\n            prest_commentaires.push(a);\n        }\n    })\n    return {error: 0, status: 200, data: prest_commentaires};\n}\n\nasync function sendAvisOfUser(data){\n    try {\n        let newId = avis.length + 1;\n        let insert = {\n            id_commentaire: newId,\n            id_prestataire: parseInt(data[0]),\n            id_utilisateur: data[3],\n            texte: data[2],\n            note: data[1],\n        };\n        avis.push(insert);\n        return {error: 0, status: 200}\n    }catch (error){\n        console.error(\"Erreur lors de l'ajout de la billetterie :\", error.message);\n        return {error: 1, status: 404, data:\"Erreur lors de l'ajout de l'avis :\" + error.message}\n    }\n}\n\nexport default {\n    getAllPrestataires,\n    insertCommandeBillet,\n    connexion,\n    getAvisOfPrestataire,\n    sendAvisOfUser,\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}